<div class="container">
  <header class="header">
    <h1>tasks</h1>
    <p class="subtitle">{{ activeCount }} active</p>
  </header>

  <div class="add-task">
    <input 
      type="text" 
      [(ngModel)]="newTask.title"
      (keyup.enter)="addTask()"
      placeholder="What needs to be done?"
      class="task-input"
    >
    <input 
      type="text" 
      [(ngModel)]="newTask.description"
      (keyup.enter)="addTask()"
      placeholder="Add description (optional)"
      class="task-input description-input"
    >
    <button (click)="addTask()" class="btn-add">Add</button>
  </div>

  <div class="filters">
    <button 
      [class.active]="filter === 'all'"
      (click)="filter = 'all'"
      class="filter-btn"
    >All</button>
    <button 
      [class.active]="filter === 'active'"
      (click)="filter = 'active'"
      class="filter-btn"
    >Active</button>
    <button 
      [class.active]="filter === 'completed'"
      (click)="filter = 'completed'"
      class="filter-btn"
    >Completed</button>
  </div>

  <div class="tasks-list">
    <div 
      *ngFor="let task of filteredTasks" 
      class="task-item"
      [class.completed]="task.completed"
    >
      <div *ngIf="editingTask?.id !== task.id" class="task-view">
        <label class="checkbox-wrapper">
          <input 
            type="checkbox" 
            [checked]="task.completed"
            (change)="toggleTask(task)"
          >
          <span class="checkmark"></span>
        </label>
        
        <div class="task-content" (dblclick)="startEdit(task)">
          <h3 class="task-title">{{ task.title }}</h3>
          <p *ngIf="task.description" class="task-description">
            {{ task.description }}
          </p>
        </div>

        <div class="task-actions">
          <button (click)="startEdit(task)" class="btn-icon" title="Edit">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
          <button (click)="deleteTask(task.id)" class="btn-icon btn-delete" title="Delete">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
          </button>
        </div>
      </div>

      <div *ngIf="editingTask?.id === task.id && editingTask" class="task-edit">
        <input 
          type="text" 
          [(ngModel)]="editingTask!.title"
          (keyup.enter)="saveEdit()"
          (keyup.escape)="cancelEdit()"
          class="task-input"
        >
        <input 
          type="text" 
          [(ngModel)]="editingTask!.description"
          (keyup.enter)="saveEdit()"
          (keyup.escape)="cancelEdit()"
          class="task-input"
          placeholder="Description"
        >
        <div class="edit-actions">
          <button (click)="saveEdit()" class="btn-save">Save</button>
          <button (click)="cancelEdit()" class="btn-cancel">Cancel</button>
        </div>
      </div>
    </div>

    <div *ngIf="filteredTasks.length === 0" class="empty-state">
      <p>{{ filter === 'all' ? 'No tasks yet. Add one above!' : 'No ' + filter + ' tasks.' }}</p>
    </div>
  </div>

  <footer class="footer" *ngIf="tasks.length > 0">
    <span class="count">{{ activeCount }} {{ activeCount === 1 ? 'item' : 'items' }} left</span>
    <button 
      *ngIf="tasks.length > activeCount"
      (click)="clearCompleted()" 
      class="btn-clear"
    >
      Clear completed
    </button>
  </footer>
</div>